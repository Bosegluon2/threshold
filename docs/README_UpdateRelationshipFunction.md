# 关系更新函数使用说明

## 概述
`update_relationship` 函数允许AI角色自主更新与其他角色的关系状态，记录各种互动，并自动更新记忆系统。这使AI角色能够主动维护关系网络，而不需要玩家手动干预。

## 函数信息
- **函数名**: `update_relationship`
- **描述**: 更新与目标角色的关系状态，记录互动、信任变化、关系变化等，并自动更新记忆系统

## 参数说明

| 参数名 | 类型 | 必需 | 描述 |
|--------|------|------|------|
| `target_id` | string | 否 | 目标角色ID（与target_name二选一） |
| `target_name` | string | 否 | 目标角色名称（与target_id二选一） |
| `interaction_type` | string | 是 | 互动类型（见下方详细说明） |
| `description` | string | 是 | 互动的详细描述 |
| `trust_change` | int | 否 | 信任程度变化（某些类型会自动计算） |
| `relationship_change` | int | 否 | 关系等级变化（某些类型会自动计算） |
| `severity` | int | 否 | 冲突严重程度（仅用于conflict类型，默认1） |
| `is_important` | bool | 否 | 是否为重要事件（影响记忆分类，默认false） |

## 互动类型详解

### 1. 基础互动类型

#### `general_interaction` - 一般互动
- **描述**: 普通的日常互动
- **自动变化**: 无，需要手动指定trust_change和relationship_change
- **示例**: 聊天、问候、简单交流

#### `custom` - 自定义互动
- **描述**: 完全自定义的互动类型
- **自动变化**: 无，需要手动指定所有变化
- **示例**: 特殊事件、独特互动

### 2. 信任建立类型

#### `share_secret` - 分享秘密
- **描述**: 向对方分享个人秘密
- **自动变化**: 信任+5, 关系+3
- **示例**: 分享个人目标、恐惧、秘密等

#### `give_favor` - 给予帮助
- **描述**: 主动帮助对方
- **自动变化**: 信任+3, 关系+2
- **示例**: 提供物品、技能帮助、解决问题

#### `receive_favor` - 接受帮助
- **描述**: 接受对方的帮助
- **自动变化**: 信任+5, 关系+4
- **示例**: 接受治疗、获得物品、学习技能

#### `loyalty` - 忠诚表现
- **描述**: 对方表现出忠诚行为
- **自动变化**: 信任+10, 关系+8
- **示例**: 在危机时刻保护、保守秘密、支持决定

### 3. 关系深化类型

#### `training` - 训练/学习
- **描述**: 一起训练或学习
- **自动变化**: 信任+3, 关系+2
- **示例**: 魔法训练、战斗训练、知识学习

#### `adventure` - 冒险/任务
- **描述**: 一起完成冒险或任务
- **自动变化**: 信任+4, 关系+3
- **示例**: 探索遗迹、完成任务、共同战斗

#### `cooperation` - 合作
- **描述**: 在某个项目上合作
- **自动变化**: 信任+4, 关系+3
- **示例**: 研究魔法、建设设施、制定计划

### 4. 社交互动类型

#### `gift` - 礼物/馈赠
- **描述**: 给予或接受礼物
- **自动变化**: 信任+5, 关系+4
- **示例**: 生日礼物、感谢礼物、节日祝福

#### `celebration` - 庆祝/聚会
- **描述**: 一起庆祝或聚会
- **自动变化**: 信任+2, 关系+3
- **示例**: 生日派对、胜利庆祝、节日聚会

#### `sorrow` - 悲伤/安慰
- **描述**: 在悲伤时刻给予安慰
- **自动变化**: 信任+6, 关系+5
- **示例**: 安慰失去亲人、安慰失败、心理支持

### 5. 冲突与和解类型

#### `conflict` - 冲突
- **描述**: 与对方发生冲突
- **自动变化**: 信任-5×严重程度, 关系-3×严重程度
- **参数**: 需要指定severity（严重程度）
- **示例**: 意见分歧、利益冲突、误解

#### `reconciliation` - 和解
- **描述**: 与对方和解
- **自动变化**: 无，需要手动指定trust_change和relationship_change
- **示例**: 道歉、谅解、重新建立信任

#### `betrayal` - 背叛
- **描述**: 被对方背叛
- **自动变化**: 信任-20, 关系-15
- **示例**: 泄露秘密、背叛信任、背叛组织

### 6. 竞争类型

#### `competition` - 竞争/比赛
- **描述**: 与对方竞争或比赛
- **自动变化**: 信任-2, 关系-1（可覆盖）
- **示例**: 魔法比赛、战斗竞技、技能比拼

## 使用示例

### 示例1: 分享秘密
```json
{
  "name": "update_relationship",
  "arguments": {
    "target_name": "雷克斯",
    "interaction_type": "share_secret",
    "description": "我向他透露了我其实有一个隐藏的黑暗魔法天赋，这是我最大的秘密",
    "is_important": true
  }
}
```

### 示例2: 一起冒险
```json
{
  "name": "update_relationship",
  "arguments": {
    "target_name": "艾莉娅",
    "interaction_type": "adventure",
    "description": "我们一起探索了古老的魔法遗迹，发现了失传的魔法知识",
    "is_important": true
  }
}
```

### 示例3: 冲突与和解
```json
{
  "name": "update_relationship",
  "arguments": {
    "target_name": "雷克斯",
    "interaction_type": "conflict",
    "description": "我们因为对魔法学院政策的看法不同而发生了激烈争论",
    "severity": 2,
    "is_important": true
  }
}
```

```json
{
  "name": "update_relationship",
  "arguments": {
    "target_name": "雷克斯",
    "interaction_type": "reconciliation",
    "description": "我们通过深入交流理解了彼此的观点，达成了共识",
    "trust_change": 3,
    "relationship_change": 2,
    "is_important": true
  }
}
```

### 示例4: 自定义互动
```json
{
  "name": "update_relationship",
  "arguments": {
    "target_name": "艾莉娅",
    "interaction_type": "custom",
    "description": "我们一起研究了一本古老的魔法书，发现了新的魔法理论",
    "trust_change": 4,
    "relationship_change": 3,
    "is_important": true
  }
}
```

## 系统特性

### 1. 自动关系管理
- **智能计算**: 某些互动类型会自动计算信任和关系变化
- **关系类型更新**: 自动根据综合分数调整关系类型
- **历史追踪**: 记录所有互动历史

### 2. 记忆系统集成
- **自动记录**: 所有互动自动记录到记忆系统
- **分类存储**: 重要事件自动分类到ImportantEvents
- **时间戳**: 所有记忆都带有精确的时间记录

### 3. 关系网络维护
- **初次见面**: 自动创建关系记录
- **动态更新**: 实时更新关系状态
- **统计信息**: 提供详细的关系统计

## 最佳实践

### 1. 选择合适的互动类型
- 使用预定义类型获得自动计算的好处
- 对于特殊互动使用custom类型
- 根据互动的性质选择最合适的类型

### 2. 描述的重要性
- 提供详细、具体的互动描述
- 包含情感和上下文信息
- 描述对关系的影响

### 3. 重要事件标记
- 标记真正重要的事件
- 避免过度标记普通互动
- 重要事件会影响记忆分类

### 4. 关系平衡
- 避免关系变化过于剧烈
- 保持信任和关系的合理比例
- 考虑长期关系发展

## 注意事项

1. **参数验证**: 确保提供必要的参数
2. **目标角色**: 确保目标角色存在
3. **互动类型**: 选择最合适的互动类型
4. **变化幅度**: 避免过大的信任/关系变化
5. **记忆管理**: 定期清理过期的记忆数据

## 扩展建议

1. **新互动类型**: 可以添加更多预定义的互动类型
2. **文化因素**: 考虑不同文化背景的互动模式
3. **时间因素**: 关系随时间自然变化
4. **群体互动**: 支持多角色同时互动
5. **情感系统**: 更复杂的情感状态管理

