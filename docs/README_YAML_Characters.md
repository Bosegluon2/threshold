# 人物YAML系统说明

## 概述
本系统现在支持从YAML文件加载和管理人物设定，提供了更好的可扩展性和数据管理能力。

## 文件结构

### 数据文件夹
```
data/
├── world_lore.yaml          # 世界观设定
└── characters/              # 人物文件夹
    ├── char_0001.yaml      # 艾莉娅的人物设定
    └── char_0002.yaml      # 雷克斯的人物设定
```

### 人物YAML文件格式
每个人物文件使用 `{人物ID}.yaml` 的命名格式，例如：
- `char_0001.yaml` - 艾莉娅
- `char_0002.yaml` - 雷克斯

## YAML文件结构

### 基本属性
```yaml
id: "char_0001"                    # 人物唯一ID
name: "艾莉娅"                     # 人物名称
personality: "聪明、好奇、善良但有些傲慢"  # 性格描述
gender: "女"                       # 性别
age: 25                           # 年龄
profession: "魔法师"               # 职业
faction: "魔法学院"                # 派别
background_story: "艾莉娅是魔法学院..."  # 背景故事
```

### 外观和风格
```yaml
appearance: "身材高挑，有着银色的长发和蓝色的眼睛，总是穿着华丽的魔法袍"
speech_style: "说话优雅，喜欢使用魔法术语，有时会显得高傲"
```

### 技能和目标
```yaml
skills:                           # 技能列表
  - "火系魔法"
  - "冰系魔法"
  - "传送魔法"
  - "魔法理论"
goals: "成为最强大的魔法师，探索魔法的奥秘"
fears: "失去魔法能力，被黑暗魔法侵蚀"
```

### 数值属性
```yaml
max_health: 100                   # 最大生命值
current_health: 100               # 当前生命值
max_energy: 100                   # 最大能量值
current_energy: 100               # 当前能量值

# WARPed System 属性
warfare: 3                        # 战争能力
adaptability: 7                   # 适应能力
reasoning: 9                      # 推理能力
perception: 8                     # 感知能力
endurance: 5                      # 耐力
dexterity: 6                      # 敏捷
```

### 知识等级
```yaml
knowledge_level: "Advanced"       # 知识等级 (None, Basic, Intermediate, Advanced, Expert)
```

### 时间戳和状态
```yaml
created_date: "2024-01-01T00:00:00"    # 创建时间
last_updated: "2024-01-01T00:00:00"    # 最后更新时间
room_id: ""                              # 当前房间ID
bound_agent_id: ""                       # 绑定的Agent ID
is_bound: false                          # 是否已绑定
```

## 使用方法

### 1. 添加新人物
1. 在 `data/characters/` 文件夹中创建新的YAML文件
2. 使用 `{人物ID}.yaml` 的命名格式
3. 按照上述结构填写人物信息
4. 重启系统，人物会自动加载

### 2. 修改现有人物
1. 直接编辑对应的YAML文件
2. 重启系统，修改会生效
3. 或者使用系统提供的保存功能

### 3. 删除人物
1. 删除对应的YAML文件
2. 重启系统，人物会被移除
3. 或者使用系统提供的删除功能

## 系统特性

### 自动加载
- 系统启动时自动扫描 `data/characters/` 文件夹
- 自动加载所有 `.yaml` 和 `.yml` 文件
- 为每个加载的人物自动创建对应的Agent

### 错误处理
- 如果YAML文件加载失败，系统会使用硬编码的后备方案
- 详细的错误日志帮助调试问题
- 单个文件错误不会影响其他人物加载

### 数据持久化
- 新创建的人物自动保存到YAML文件
- 支持手动保存和批量保存
- 删除人物时自动清理YAML文件

## 扩展建议

### 1. 人物模板
可以创建不同类型人物的模板文件，例如：
- `template_mage.yaml` - 魔法师模板
- `template_warrior.yaml` - 战士模板
- `template_merchant.yaml` - 商人模板

### 2. 批量导入
可以开发批量导入功能，支持从其他格式（如CSV、JSON）导入人物数据

### 3. 版本控制
建议将 `data/characters/` 文件夹加入版本控制，方便团队协作和备份

### 4. 验证工具
可以开发YAML文件验证工具，确保文件格式正确和必要字段完整

## 注意事项

1. **文件编码**：确保YAML文件使用UTF-8编码，支持中文字符
2. **ID唯一性**：每个人物必须有唯一的ID，建议使用 `char_XXXX` 格式
3. **字段完整性**：虽然大部分字段都有默认值，但建议填写完整的人物信息
4. **备份**：修改人物文件前建议先备份，避免数据丢失
5. **测试**：添加新人物后，建议重启系统测试是否正常加载

## 故障排除

### 常见问题

1. **人物未加载**
   - 检查YAML文件语法是否正确
   - 确认文件路径和命名格式
   - 查看控制台错误日志

2. **中文显示乱码**
   - 确认文件使用UTF-8编码
   - 检查Godot项目的文本编码设置

3. **属性值异常**
   - 检查数值字段是否为有效数字
   - 确认枚举值是否正确（如知识等级）

4. **文件权限问题**
   - 确认程序有读写 `data/characters/` 文件夹的权限
   - 检查文件是否被其他程序占用

### 调试技巧

1. 启用详细日志输出
2. 使用YAML验证工具检查文件格式
3. 逐步测试，先确保基本字段正常，再添加复杂属性
4. 对比正常工作的YAML文件，找出差异
